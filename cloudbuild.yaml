steps:
- name: gcr.io/cloud-builders/gcloud
  args:
  - kms
  - decrypt
  - --ciphertext-file=firebase-${_ENVIRONMENT}.enc
  - --plaintext-file=.${_ENVIRONMENT}.env
  - --location=global
  - --keyring=${_KEYRING_NAME}
  - --key=${_KEY_NAME}
- name: 'gcr.io/cloud-builders/npm'
  args: ['install']
- name: 'gcr.io/cloud-builders/npm'
  args: ['run', 'build']
- name: 'gcr.io/cloud-builders/npm'
  args: ['test']
- name: 'gcr.io/cloud-builders/npm'
  args: ['npm', 'install', '-g', 'firebase-tools']
- name: 'gcr.io/cloud-builders/npm'
  args: ['firebase', '--token', '${_FIREBASE_TOKEN}', 'deploy', '-P', '$PROJECT_ID']